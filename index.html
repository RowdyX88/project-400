
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Panels Scaffold</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet.js for map panel -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet.markercluster for clustering support -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <link rel="stylesheet" href="src/ui/layout.css" />
  </head>
  <body class="bg-blue-950 text-blue-100 min-h-screen">
    <div class="relative min-h-screen w-full">
      <!-- Floating draggable left panel -->
      <div id="left-panel" class="draggable panel glassy left-panel" style="position:absolute; left:24px; top:24px; min-width:240px; max-width:320px;">
        <!-- Left panel will be rendered by JS -->
      </div>
      <!-- Floating draggable map panel -->
  <div id="map-panel" class="draggable panel glassy map-panel" style="position:absolute; left:360px; top:24px; width:940px;">
        <h2 class="text-amber-300 font-bold mb-2">Map</h2>
        <div id="map-container"></div>
      </div>
      <!-- Insights panel (mirrors timeline, fetches web context) -->
  <div id="insights-panel" class="draggable panel glassy" style="position:absolute; left:1324px; top:24px; width:400px; min-width:320px;">
        <h2 class="text-cyan-300 font-bold mb-2">Insights</h2>
        <div id="insights-content" style="overflow:auto; padding-right:8px;"></div>
      </div>
      <!-- Timeline panel below -->
  <div id="timeline-panel" class="draggable panel glassy timeline-panel" style="position:absolute; left:24px; top:568px; width:calc(100% - 48px);">
        <h2 class="text-amber-300 font-bold mb-2">Timeline</h2>
        <div class="filmstrip" id="timeline-strip"></div>
        <input id="year-slider" type="range" min="1900" max="2025" value="1949" step="1" title="Select year" class="slider w-full mt-2" />
        <div id="year-readout" class="year-readout mt-2">1949</div>
      </div>
    </div>
    </div>
  <script type="module" src="dist/main.js"></script>
    <script>
    // Simple drag-and-drop for .draggable panels
    document.addEventListener('DOMContentLoaded', () => {
      // Remove transform from timeline panel for proper drag/resize
      const timelinePanel = document.getElementById('timeline-panel');
      if (timelinePanel) {
    timelinePanel.style.transform = '';
    timelinePanel.style.bottom = '';
    timelinePanel.style.zIndex = 100;
      }
      document.querySelectorAll('.draggable').forEach(panel => {
        let isDragging = false, startX = 0, startY = 0, origX = 0, origY = 0;
        panel.addEventListener('mousedown', e => {
            if (e.button !== 0) return;
            // Prevent drag if clicking inside map container
            if (panel.id === 'map-panel' && e.target && (e.target.id === 'leaflet-map' || e.target.closest && e.target.closest('#leaflet-map'))) return;
            // Only drag if not clicking on input, textarea, button, select, or resize handle
            var tag = e.target && e.target.tagName ? e.target.tagName.toLowerCase() : "";
            if (["input","textarea","button","select","option","label"].indexOf(tag) !== -1 || (e.target.classList && e.target.classList.contains('resize-handle'))) return;
            // Only drag if not clicking inside a contenteditable element
            if (e.target && (e.target.isContentEditable || (e.target.closest && e.target.closest('[contenteditable="true"]')))) return;
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            origX = panel.offsetLeft;
            origY = panel.offsetTop;
            panel.style.zIndex = 100;
            document.body.style.userSelect = 'none';
            e.preventDefault();
        });
        window.addEventListener('mousemove', e => {
          if (!isDragging) return;
          let dx = e.clientX - startX;
          let dy = e.clientY - startY;
          panel.style.left = (origX + dx) + 'px';
          panel.style.top = (origY + dy) + 'px';
        });
        window.addEventListener('mouseup', () => {
          if (isDragging) {
            isDragging = false;
            panel.style.zIndex = 20;
            setTimeout(() => { document.body.style.userSelect = ''; }, 0);
          }
        });
        // Add resize handle
        const resize = document.createElement('div');
  resize.className = 'resize-handle';
  resize.style.userSelect = 'none';
        resize.style.position = 'absolute';
        resize.style.right = '0';
        resize.style.bottom = '0';
  resize.style.width = '20px';
  resize.style.height = '20px';
        resize.style.background = 'linear-gradient(135deg, #FFC300 40%, #1e293b 60%)';
        resize.style.cursor = 'nwse-resize';
        resize.style.borderRadius = '0 0 12px 0';
  resize.style.boxShadow = '0 0 0 1px rgba(255,255,255,0.25) inset, 0 2px 8px rgba(0,0,0,0.35)';
  resize.style.zIndex = '9999';
        panel.appendChild(resize);
        let isResizing = false, startW = 0, startH = 0;
        resize.addEventListener('mousedown', e => {
          e.stopPropagation();
          isResizing = true;
          startX = e.clientX;
          startY = e.clientY;
          startW = panel.offsetWidth;
          startH = panel.offsetHeight;
          panel.style.zIndex = 101;
          document.body.style.userSelect = 'none';
          e.preventDefault();
        });
        window.addEventListener('mousemove', e => {
          if (!isResizing) return;
          let dw = e.clientX - startX;
          let dh = e.clientY - startY;
          // Apply width/height while honoring computed CSS min sizes
          const cs = window.getComputedStyle(panel);
          const minW = parseFloat(cs.minWidth) || 180;
          const minH = parseFloat(cs.minHeight) || 120;
          const newW = Math.max(minW, startW + dw);
          const newH = Math.max(minH, startH + dh);
          panel.style.width = newW + 'px';
          panel.style.height = newH + 'px';
          // If resizing map panel, resize map container and Leaflet map
          if (panel.id === 'map-panel') {
            const mapContainer = panel.querySelector('#map-container');
            if (mapContainer) {
              mapContainer.style.height = Math.max(120, panel.offsetHeight - 60) + 'px';
              mapContainer.style.width = '100%';
              // Resize Leaflet map if present
              const leafletMap = mapContainer.querySelector('#leaflet-map');
              if (leafletMap && window.L && window.L.DomUtil && window.L.DomUtil.get('leaflet-map') && window.L.DomUtil.get('leaflet-map')._leaflet_map) {
                setTimeout(() => {
                  window.L.DomUtil.get('leaflet-map')._leaflet_map.invalidateSize();
                }, 50);
              }
            }
          }
        });
        window.addEventListener('mouseup', () => {
          if (isResizing) {
            isResizing = false;
            panel.style.zIndex = 20;
            setTimeout(() => { document.body.style.userSelect = ''; }, 0);
          }
        });
      });
    });
    </script>
    <style>
      body {
        background: linear-gradient(120deg, #0f172a 60%, #1e293b 100%);
      }
      .glassy {
        background: rgba(30,41,59,0.85);
        box-shadow: 0 8px 32px rgba(0,0,0,0.35);
        border-radius: 18px;
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
        border: 1.5px solid rgba(255,255,255,0.08);
      }
      .panel {
        padding: 24px 18px;
        min-height: 100px;
        transition: box-shadow 0.2s, transform 0.2s;
      }
      .draggable {
        cursor: move;
      }
      .left-panel {
        min-width: 220px;
        max-width: 320px;
      }
      .timeline-panel {
        min-width: 400px;
      }
      .filmstrip {
        display: flex;
        flex-direction: row;
        gap: 10px;
        overflow-x: auto;
        padding: 12px;
        background: transparent;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.07);
        min-height: 68px;
      }
      .event-chip { 
        display: flex;
        flex-direction: column;
        padding: 12px;
        min-width: 200px;
        max-width: 260px;
        background: rgba(30,41,59,0.92); /* like category panel */
        border-radius: 12px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.18);
        border: 1px solid #334155;
        transition: transform 0.16s, box-shadow 0.16s, border-color 0.16s, background 0.16s, color 0.16s;
        cursor: pointer;
        position: relative;
        color: #cbd5e1; /* default text like category list */
      }
      .event-chip::before {
        content: "";
        position: absolute; left: 0; right: 0; top: 0; height: 3px;
        border-top-left-radius: 12px; border-top-right-radius: 12px;
        background: #fbbf24; /* amber accent like category */
      }
      .event-chip:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,0.28); background: rgba(51,65,85,0.98); border-color: #475569; }
      .event-chip.active { background: #fbbf24; border-color: #fbbf24; color: #1e293b; box-shadow: 0 0 0 2px rgba(251,191,36,0.5); }
      /* Text inside chips matching category palette */
      .chip-title { margin-top: 6px; font-size: 14px; font-weight: 800; color: #fbbf24; line-height: 1.3; }
      .event-chip.active .chip-title { color: #1e293b; }
      .chip-summary { margin-top: 6px; font-size: 12px; color: #cbd5e1; line-height: 1.5; }
      .event-chip.active .chip-summary { color: #0b1220; }
      .chip-tags { margin-top: 8px; display:flex; gap:6px; flex-wrap: wrap; }
      .chip-tag { font-size: 11px; color:#e5e7eb; background:#1f2937; border:1px solid #475569; padding:2px 6px; border-radius: 999px; }
      .event-chip.active .chip-tag { color:#1e293b; background:#fde68a; border-color:#f59e0b; }
      .chip-year { font-size: 11px; font-weight: 800; color: #e5e7eb; background:#1f2937; border:1px solid #475569; padding: 2px 6px; border-radius: 999px; }
      .event-chip.active .chip-year { color:#1e293b; background:#fff7d6; border-color:#f59e0b; }
      .category {
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        margin-bottom: 8px;
        background: rgba(30,41,59,0.92);
        color: #fbbf24;
        font-size: 16px;
        font-weight: 500;
        border: 1px solid #334155;
        transition: background 0.18s, color 0.18s;
      }
      .category.active {
        background: #fbbf24;
        color: #1e293b;
        font-weight: 700;
      }
      #year-slider {
        width: 100%;
      }
      .year-readout {
        font-weight: 600;
        text-align: right;
        color: #fbbf24;
        font-size: 18px;
      }
    #map-panel {
      display: flex;
      flex-direction: column;
  min-height: 420px;
  height: 520px;
    }
    #map-container {
      flex: 1 1 auto;
      width: 100%;
      height: 100%;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }
  /* Make insights panel flexible so its content grows/shrinks with resize */
  #insights-panel { display: flex; flex-direction: column; height: 520px; }
  #insights-content { flex: 1 1 auto; min-height: 0; }
  #timeline-panel { height: 380px; }
    #leaflet-map {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      position: absolute;
      top: 0;
      left: 0;
    }
  /* Make timeline panel content flex so height resize is meaningful */
  #timeline-panel { display: flex; flex-direction: column; }
  #timeline-panel .filmstrip { flex: 1 1 auto; min-height: 0; }
    </style>
  </body>
</html>
