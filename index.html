
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BuildByer</title>
  <meta name="application-name" content="BuildByer" />
  <meta name="apple-mobile-web-app-title" content="BuildByer" />
  <meta name="description" content="BuildByer â€” interactive map, timeline, and insights." />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet.js for map panel -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet.markercluster for clustering support -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <!-- App icons / favicon -->
  <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico" />
  <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon.png" />
  <link rel="manifest" href="site.webmanifest" />
  <meta name="msapplication-config" content="assets/icons/browserconfig.xml" />
  <meta name="msapplication-TileColor" content="#0f172a" />
  <meta name="theme-color" content="#0f172a" />
  <link rel="stylesheet" href="src/ui/layout.css" />
  </head>
  <body class="bg-blue-950 text-blue-100 min-h-screen" style="overflow-x:hidden;">
  <div id="app" class="relative min-h-screen w-full" style="max-width:min(1400px, 100dvw); margin:0 auto; padding:0 16px;">
      <!-- Floating draggable left panel -->
      <div id="left-panel" class="draggable panel glassy left-panel" style="position:absolute; left:24px; top:24px; min-width:240px; max-width:320px;">
        <!-- Left panel will be rendered by JS -->
      </div>
      <!-- Floating draggable map panel -->
  <div id="map-panel" class="draggable panel glassy map-panel" style="position:absolute; left:calc(320px + 40px); top:24px; width:min(940px, calc(100% - 320px - 40px - 420px));">
        <h2 class="text-amber-300 font-bold mb-2">Map</h2>
        <div id="map-container">
          <!-- Phone-only overlays: category micro-dock and insights chip -->
          <div id="cat-dock" class="cat-dock" aria-label="Categories dock"></div>
          <button id="insights-chip" class="insights-chip" aria-expanded="false" aria-controls="insights-panel" title="Open insights">Insights</button>
        </div>
      </div>
      <!-- Insights panel (mirrors timeline, fetches web context) -->
  <div id="insights-panel" class="draggable panel glassy" style="position:absolute; right:24px; top:24px; width:400px; min-width:320px;">
        <h2 class="text-cyan-300 font-bold mb-2">Insights</h2>
        <div id="insights-content" style="overflow:auto; padding-right:8px;"></div>
      </div>
      <!-- Timeline panel below -->
  <div id="timeline-panel" class="draggable panel glassy timeline-panel" style="position:absolute; left:24px; top:568px; width:calc(100% - 48px);">
        <h2 class="text-amber-300 font-bold mb-2">Timeline</h2>
        <div class="filmstrip" id="timeline-strip"></div>
        <div id="year-row" class="year-row mt-2">
          <span id="year-min" class="year-end">1900</span>
          <div id="year-slider-wrap" class="year-slider-wrap">
            <input id="year-slider" type="range" min="1900" max="2025" value="1949" step="1" title="Select year" class="slider w-full" />
            <div id="year-tooltip" class="year-tooltip">1949</div>
          </div>
          <span id="year-max" class="year-end">2025</span>
        </div>
        <div id="year-readout" class="year-readout mt-2">1949</div>
      </div>
  <!-- (Deprecated) bottom mobile dock is kept for fallback but hidden by default -->
  <div id="mobile-dock" class="mobile-dock" aria-hidden="true"></div>
  </div>
  <script type="module" src="dist/main.js"></script>
    <script>
    // Simple drag-and-drop for .draggable panels (disabled on small screens)
    document.addEventListener('DOMContentLoaded', () => {
  const mq = window.matchMedia('(max-width: 768px)');
  const mqCompact = window.matchMedia('(max-width: 900px)');
      const mqPhone = window.matchMedia('(max-width: 480px)');
      const app = document.getElementById('app');
      const left = document.getElementById('left-panel');
      const insights = document.getElementById('insights-panel');
    const dock = document.getElementById('mobile-dock');
    const insightsChip = document.getElementById('insights-chip');
      const updateResponsiveMode = () => {
        if (mq.matches) {
          document.body.classList.add('mobile');
        } else {
          document.body.classList.remove('mobile');
        }
        // Toggle phone mode features
        if (mqPhone.matches) {
          app && app.classList.add('phone');
      // We use top-right insights chip + left micro-dock; hide bottom dock
      dock && (dock.style.display = 'none');
          left && left.classList.remove('show');
          insights && insights.classList.remove('show');
        } else {
          app && app.classList.remove('phone');
      dock && (dock.style.display = 'none');
          // Ensure drawers not overlaying when leaving phone mode
          left && left.classList.remove('show');
          insights && insights.classList.remove('show');
        }
        // Invalidate Leaflet map size after layout changes
        setTimeout(() => {
          try {
            if (window.L && window.L.DomUtil) {
              const el = document.getElementById('leaflet-map');
              const mapEl = el && window.L.DomUtil.get('leaflet-map');
              if (mapEl && mapEl._leaflet_map) {
                mapEl._leaflet_map.invalidateSize();
              }
            }
          } catch {}
        }, 150);
      };
  mq.addEventListener('change', updateResponsiveMode);
  mqCompact.addEventListener('change', updateResponsiveMode);
      mqPhone.addEventListener('change', updateResponsiveMode);
      updateResponsiveMode();

      // Insights chip interaction (phone)
      if (insightsChip) insightsChip.addEventListener('click', () => {
        if (!insights) return;
        const show = !insights.classList.contains('show');
        insights.classList.toggle('show', show);
        insightsChip.setAttribute('aria-expanded', show ? 'true' : 'false');
        insightsChip.textContent = show ? 'Close' : 'Insights';
        // hide the left drawer if it was open
        left && left.classList.remove('show');
        updateResponsiveMode();
      });
      // Remove transform from timeline panel for proper drag/resize
      const timelinePanel = document.getElementById('timeline-panel');
      if (timelinePanel) {
    timelinePanel.style.transform = '';
    timelinePanel.style.bottom = '';
    timelinePanel.style.zIndex = 100;
      }
  // Skip drag/resize on small screens for better UX
  if (!(mq.matches || mqCompact.matches)) document.querySelectorAll('.draggable').forEach(panel => {
        let isDragging = false, startX = 0, startY = 0, origX = 0, origY = 0;
        panel.addEventListener('mousedown', e => {
            if (e.button !== 0) return;
            // Prevent drag if clicking inside map container
            if (panel.id === 'map-panel' && e.target && (e.target.id === 'leaflet-map' || e.target.closest && e.target.closest('#leaflet-map'))) return;
            // Only drag if not clicking on input, textarea, button, select, or resize handle
            var tag = e.target && e.target.tagName ? e.target.tagName.toLowerCase() : "";
            if (["input","textarea","button","select","option","label"].indexOf(tag) !== -1 || (e.target.classList && e.target.classList.contains('resize-handle'))) return;
            // Only drag if not clicking inside a contenteditable element
            if (e.target && (e.target.isContentEditable || (e.target.closest && e.target.closest('[contenteditable="true"]')))) return;
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            origX = panel.offsetLeft;
            origY = panel.offsetTop;
            panel.style.zIndex = 100;
            document.body.style.userSelect = 'none';
            e.preventDefault();
        });
        window.addEventListener('mousemove', e => {
          if (!isDragging) return;
          let dx = e.clientX - startX;
          let dy = e.clientY - startY;
          panel.style.left = (origX + dx) + 'px';
          panel.style.top = (origY + dy) + 'px';
        });
        window.addEventListener('mouseup', () => {
          if (isDragging) {
            isDragging = false;
            panel.style.zIndex = 20;
            setTimeout(() => { document.body.style.userSelect = ''; }, 0);
          }
        });
        // Add resize handle
        const resize = document.createElement('div');
  resize.className = 'resize-handle';
  resize.style.userSelect = 'none';
        resize.style.position = 'absolute';
        resize.style.right = '0';
        resize.style.bottom = '0';
  resize.style.width = '20px';
  resize.style.height = '20px';
        resize.style.background = 'linear-gradient(135deg, #FFC300 40%, #1e293b 60%)';
        resize.style.cursor = 'nwse-resize';
        resize.style.borderRadius = '0 0 12px 0';
  resize.style.boxShadow = '0 0 0 1px rgba(255,255,255,0.25) inset, 0 2px 8px rgba(0,0,0,0.35)';
  resize.style.zIndex = '9999';
  panel.appendChild(resize);
        let isResizing = false, startW = 0, startH = 0;
        resize.addEventListener('mousedown', e => {
          e.stopPropagation();
          isResizing = true;
          startX = e.clientX;
          startY = e.clientY;
          startW = panel.offsetWidth;
          startH = panel.offsetHeight;
          panel.style.zIndex = 101;
          document.body.style.userSelect = 'none';
          e.preventDefault();
        });
        window.addEventListener('mousemove', e => {
          if (!isResizing) return;
          let dw = e.clientX - startX;
          let dh = e.clientY - startY;
          // Apply width/height while honoring computed CSS min sizes
          const cs = window.getComputedStyle(panel);
          const minW = parseFloat(cs.minWidth) || 180;
          const minH = parseFloat(cs.minHeight) || 120;
          const newW = Math.max(minW, startW + dw);
          const newH = Math.max(minH, startH + dh);
          panel.style.width = newW + 'px';
          panel.style.height = newH + 'px';
          // If resizing map panel, resize map container and Leaflet map
          if (panel.id === 'map-panel') {
            const mapContainer = panel.querySelector('#map-container');
            if (mapContainer) {
              mapContainer.style.height = Math.max(120, panel.offsetHeight - 60) + 'px';
              mapContainer.style.width = '100%';
              // Resize Leaflet map if present
              const leafletMap = mapContainer.querySelector('#leaflet-map');
              if (leafletMap && window.L && window.L.DomUtil && window.L.DomUtil.get('leaflet-map') && window.L.DomUtil.get('leaflet-map')._leaflet_map) {
                setTimeout(() => {
                  window.L.DomUtil.get('leaflet-map')._leaflet_map.invalidateSize();
                }, 50);
              }
            }
          }
        });
        window.addEventListener('mouseup', () => {
          if (isResizing) {
            isResizing = false;
            panel.style.zIndex = 20;
            setTimeout(() => { document.body.style.userSelect = ''; }, 0);
          }
        });
  });
    });
    </script>
    <style>
  html, body { max-width: 100dvw; }
  body {
        background: linear-gradient(120deg, #0f172a 60%, #1e293b 100%);
      }
      .glassy {
        background: rgba(30,41,59,0.85);
        box-shadow: 0 8px 32px rgba(0,0,0,0.35);
        border-radius: 18px;
  -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
        border: 1.5px solid rgba(255,255,255,0.08);
      }
      .panel {
        padding: 24px 18px;
        min-height: 100px;
        transition: box-shadow 0.2s, transform 0.2s;
      }
      .draggable {
        cursor: move;
      }
      .left-panel {
        min-width: 220px;
        max-width: 320px;
      }
      .timeline-panel {
        min-width: 400px;
      }
      .filmstrip {
        display: flex;
        flex-direction: row;
        gap: 10px;
        overflow-x: auto;
        padding: 12px;
        background: transparent;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.07);
        min-height: 68px;
      }
      .event-chip { 
        display: flex;
        flex-direction: column;
        padding: 12px;
        min-width: 200px;
        max-width: 260px;
        background: rgba(30,41,59,0.92); /* like category panel */
        border-radius: 12px;
        box-shadow: 0 4px 14px rgba(0,0,0,0.18);
        border: 1px solid #334155;
        transition: transform 0.16s, box-shadow 0.16s, border-color 0.16s, background 0.16s, color 0.16s;
        cursor: pointer;
        position: relative;
        color: #cbd5e1; /* default text like category list */
      }
      .event-chip::before {
        content: "";
        position: absolute; left: 0; right: 0; top: 0; height: 3px;
        border-top-left-radius: 12px; border-top-right-radius: 12px;
        background: #fbbf24; /* amber accent like category */
      }
      .event-chip:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,0.28); background: rgba(51,65,85,0.98); border-color: #475569; }
      .event-chip.active { background: #fbbf24; border-color: #fbbf24; color: #1e293b; box-shadow: 0 0 0 2px rgba(251,191,36,0.5); }
      /* Text inside chips matching category palette */
      .chip-title { margin-top: 6px; font-size: 14px; font-weight: 800; color: #fbbf24; line-height: 1.3; }
      .event-chip.active .chip-title { color: #1e293b; }
      .chip-summary { margin-top: 6px; font-size: 12px; color: #cbd5e1; line-height: 1.5; }
      .event-chip.active .chip-summary { color: #0b1220; }
      .chip-tags { margin-top: 8px; display:flex; gap:6px; flex-wrap: wrap; }
      .chip-tag { font-size: 11px; color:#e5e7eb; background:#1f2937; border:1px solid #475569; padding:2px 6px; border-radius: 999px; }
      .event-chip.active .chip-tag { color:#1e293b; background:#fde68a; border-color:#f59e0b; }
      .chip-year { font-size: 11px; font-weight: 800; color: #e5e7eb; background:#1f2937; border:1px solid #475569; padding: 2px 6px; border-radius: 999px; }
      .event-chip.active .chip-year { color:#1e293b; background:#fff7d6; border-color:#f59e0b; }
      .category {
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
        margin-bottom: 8px;
        background: rgba(30,41,59,0.92);
        color: #fbbf24;
        font-size: 16px;
        font-weight: 500;
        border: 1px solid #334155;
        transition: background 0.18s, color 0.18s;
      }
      .category.active {
        background: #fbbf24;
        color: #1e293b;
        font-weight: 700;
      }
      #year-slider {
        width: 100%;
      }
      .year-readout {
        font-weight: 600;
        text-align: right;
        color: #fbbf24;
        font-size: 18px;
      }
    #map-panel {
      display: flex;
      flex-direction: column;
  min-height: 420px;
  height: 520px;
    }
  #map-container {
      flex: 1 1 auto;
      width: 100%;
      height: 100%;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }
  /* Make insights panel flexible so its content grows/shrinks with resize */
  #insights-panel { display: flex; flex-direction: column; height: 520px; }
  #insights-content { flex: 1 1 auto; min-height: 0; }
  #timeline-panel { height: 380px; }
    #leaflet-map {
      width: 100%;
      height: 100%;
      border-radius: 12px;
      position: absolute;
      top: 0;
      left: 0;
    }
  /* Make timeline panel content flex so height resize is meaningful */
  #timeline-panel { display: flex; flex-direction: column; }
  #timeline-panel .filmstrip { flex: 1 1 auto; min-height: 0; }
  /* Year slider row */
  .year-row { display: flex; align-items: center; gap: 8px; }
  .year-end { font-size: 12px; color: #cbd5e1; opacity: 0.8; min-width: 34px; text-align: center; }
  .year-slider-wrap { position: relative; flex: 1 1 auto; }
  #year-slider { width: 100%; }
  .year-tooltip { position: absolute; top: -18px; left: 50%; transform: translateX(-50%); background: rgba(2,6,23,0.85); color: #fbbf24; font-size: 11px; padding: 2px 6px; border-radius: 999px; border: 1px solid rgba(251,191,36,0.35); pointer-events: none; white-space: nowrap; }
  .mobile-dock { display: none; }
  .cat-dock { display: none; }
  .insights-chip { display: none; }

  /* Responsive: stack panels and simplify on small screens */
  @media (max-width: 768px) {
    .draggable { cursor: default; }
    #left-panel, #map-panel, #insights-panel, #timeline-panel {
      position: static !important;
      width: 100% !important;
      min-width: 0 !important;
      max-width: none !important;
      left: auto !important;
      right: auto !important;
      top: auto !important;
      margin: 12px 0;
    }
    #map-panel { height: auto; }
    #map-container { height: 320px; }
    #insights-panel { height: auto; }
    #timeline-panel { height: auto; }
    .resize-handle { display: none !important; }
    .panel { padding: 16px 14px; }
  }

  /* Compact grid (phones in landscape / small tablets): keep all panels visible */
  @media (min-width: 481px) and (max-width: 900px) {
    #app {
      display: grid;
      grid-template-columns: 84px 1fr 280px;
      grid-template-rows: auto 1fr 220px;
      gap: 12px;
      align-items: stretch;
    }
    #left-panel, #map-panel, #insights-panel, #timeline-panel {
      position: static !important;
      margin: 0 !important;
      width: auto !important;
    }
    #left-panel { grid-column: 1; grid-row: 1 / 4; overflow: auto; }
    #map-panel { grid-column: 2; grid-row: 1 / 3; height: auto; }
    #insights-panel { grid-column: 3; grid-row: 1 / 3; height: auto; }
    #timeline-panel { grid-column: 1 / 4; grid-row: 3; height: auto; }
  .year-end { font-size: 11px; }

    /* Compact category list */
    #left-panel .category { padding: 8px 10px; font-size: 13px; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    #left-panel .brand-header { display:none; }
  }

  /* Phone portrait: fixed grid with all panels visible (no page scroll) */
  @media (max-width: 480px) {
    html, body, #app { height: 100dvh !important; }
    body { overflow: hidden !important; }
    #app {
  padding: 2px 4px 4px !important;
      display: grid;
  grid-template-columns: 80px 1fr 92px; /* left cats, center map, right insights */
  grid-template-rows: 1fr 172px;        /* taller timeline to show slider + titles */
  gap: 4px;
      align-items: stretch;
    }
    /* Place panels into grid */
    #left-panel, #map-panel, #insights-panel, #timeline-panel {
      position: static !important;
      margin: 0 !important;
      width: auto !important;
      max-width: none !important;
      top: auto !important; left: auto !important; right: auto !important; bottom: auto !important;
      box-shadow: none; /* flatter on phone */
      padding: 6px 6px; /* tighter padding */
    }
    #left-panel { grid-column: 1; grid-row: 1; overflow: auto; min-height: 0; }
    #map-panel { grid-column: 2; grid-row: 1; height: auto !important; display: flex; flex-direction: column; min-height: 0; padding-top: 6px; padding-bottom: 6px; }
    #insights-panel { grid-column: 3; grid-row: 1; display:flex; flex-direction: column; overflow: hidden; min-height: 0; }
  #timeline-panel { grid-column: 1 / 4; grid-row: 2; display:flex; flex-direction: column; overflow: visible; min-height: 0; margin-top: -96px; z-index: 6; padding-bottom: max(4px, env(safe-area-inset-bottom, 0)); }

    /* Map should fill its cell */
    #map-container { height: 100% !important; min-height: 0; }
  #leaflet-map { height: 100% !important; }
  /* Make Leaflet controls smaller so they take less visual space */
  .leaflet-control { margin: 6px; }
  .leaflet-control-zoom { transform: scale(0.9); transform-origin: top left; }

    /* Insights content scrolls internally */
  #insights-panel { height: auto !important; }
  #insights-content { flex: 1 1 auto; min-height: 0; overflow: auto; }

    /* Category list: full words, small, scrollable */
    #left-panel .brand-header { display: none; }
    #left-panel .category {
      font-size: 10px; padding: 5px 6px; margin-bottom: 6px;
      white-space: normal; line-height: 1.15; word-break: break-word;
    }

  /* Hide most headings on phone to reclaim height */
  #map-panel h2, #insights-panel h2, #timeline-panel h2 { display:none; }
  #left-panel h2 { font-size: 10px; margin-bottom: 2px; }

    /* Filmstrip + slider compact */
  .filmstrip { padding: 4px; gap: 6px; min-height: 56px; }
  .event-chip { padding: 5px; min-width: 100px; }
  .chip-title { font-size: 9px; line-height: 1.2; }
  .chip-summary, .chip-tags { display:none !important; }
  #year-slider { height: 12px; margin-top: 2px; margin-bottom: 2px; }
  .year-readout { font-size: 10.5px; }

  /* Place the year slider at the top of the timeline panel */
  #timeline-panel #year-row { order: -1; }
  .year-end { font-size: 10px; min-width: 28px; }
  .year-tooltip { top: -14px; font-size: 10px; }

  /* Thin, compact range slider */
  #year-slider { appearance: none; background: transparent; }
  #year-slider::-webkit-slider-runnable-track { height: 2px; background: #475569; border-radius: 999px; }
  #year-slider::-moz-range-track { height: 2px; background: #475569; border-radius: 999px; }
  #year-slider::-ms-track { height: 2px; background: transparent; border-color: transparent; color: transparent; }
  #year-slider::-ms-fill-lower, #year-slider::-ms-fill-upper { background: #475569; border-radius: 999px; }
  #year-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: #fbbf24; border-radius: 50%; border: 2px solid #1e293b; margin-top: -6px; }
  #year-slider::-moz-range-thumb { width: 14px; height: 14px; background: #fbbf24; border: 2px solid #1e293b; border-radius: 50%; }
  #year-slider::-ms-thumb { width: 14px; height: 14px; background: #fbbf24; border: 2px solid #1e293b; border-radius: 50%; }

  /* Insights text smaller (more dense) */
  .ins-card { padding: 6px 6px; }
  .ins-title { font-size: 9.5px; line-height: 1.2; }
  .ins-summary, .ins-extra { font-size: 9px; line-height: 1.25; }
  .ins-tagline { font-size: 9px; }
  .ins-tab { font-size: 9.5px; padding: 2px 5px; }

    /* Hide micro-dock and chip in this mode */
    .mobile-dock, .cat-dock, .insights-chip { display: none !important; }
  }
    </style>
  </body>
</html>
